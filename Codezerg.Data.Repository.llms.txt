Codezerg.Data.Repository

summary: .NET Standard 2.0 (C#7.3) repository pattern library. NuGet pkg Id=Codezerg.Data.Repository v1.0.0 MIT. Depends on linq2db v5.4.1 (includes Microsoft.Data.Sqlite).

target: netstandard2.0. use cases: simple thread‑safe repositories with three storage modes via unified Repository<T> class.

### Repository<T> (where T : class, new())
Unified repository using Strategy pattern. Implements IRepository<T> and IDisposable.

Constructor: Repository(RepositoryOptions options)

### RepositoryOptions
Configuration class with factory methods:
- RepositoryOptions.InMemory() → in-memory storage only
- RepositoryOptions.Database(providerName, connectionString) → direct database storage
- RepositoryOptions.Cached(providerName, connectionString) → in-memory cache with database persistence

Properties: Mode (StorageMode), ProviderName (string), ConnectionString (string)

### StorageMode enum
- InMemory: thread-safe in-memory storage, data lost on restart, best for unit testing
- Database: direct database operations, connection-per-operation, best for write-heavy scenarios
- Cached: in-memory cache with database persistence, best for read-heavy scenarios

### IRepository<T> (where T : class)
Create:
- Insert(T entity) → T (returns entity with identity assigned)
- InsertRange(IEnumerable<T>) → IEnumerable<T>

Read:
- GetAll() → IEnumerable<T>
- Find(Expression<Func<T,bool>>) → IEnumerable<T>
- FirstOrDefault(Expression<Func<T,bool>>) → T
- Select<TResult>(Expression<Func<T,TResult>>) → IEnumerable<TResult>
- Query<TResult>(Func<IQueryable<T>,IEnumerable<TResult>>) → IEnumerable<TResult>

Update:
- Update(T entity) → int (# updated)
- UpdateRange(IEnumerable<T>) → int (# updated)

Delete:
- Delete(T entity) → int (# deleted)
- DeleteRange(IEnumerable<T>) → int (# deleted)
- DeleteMany(Expression<Func<T,bool>>) → int (# deleted)

Utility:
- Count() → int
- Count(Expression<Func<T,bool>>) → int
- Exists(Expression<Func<T,bool>>) → bool

Mode-specific (on Repository<T>):
- Clear() → void (InMemory/Cached only, clears data and resets identity)
- Refresh() → void (Cached only, reloads cache from database)

### Entity Attributes (linq2db)
- [Table("name")] or [Table("name", Database="dbname")] - table/database name
- [PrimaryKey] - marks primary key property
- [Identity] - marks auto-incrementing identity column
- [Column("name")] - column mapping with optional Name, DataType, CanBeNull, Length
- [NotColumn] - excludes property from database mapping

### Thread Safety
- InMemory: ReaderWriterLockSlim with NoRecursion policy
- Database: connection-per-operation ensures isolation
- Cached: ReaderWriterLockSlim for coordinated memory/database operations

### Automatic Schema Migrations
Database and Cached modes auto-migrate schema on initialization:
- Creates tables if not exist
- Adds new columns for new properties
- Alters column types/nullability
- SQLite uses table recreation for ALTER COLUMN

### Usage Examples
```csharp
// In-memory (testing/temp data)
using var repo = new Repository<Product>(RepositoryOptions.InMemory());

// Direct database
using var repo = new Repository<Product>(RepositoryOptions.Database(
    ProviderName.SQLite, "Data Source=products.db"));

// Cached (read-heavy with persistence)
using var repo = new Repository<Product>(RepositoryOptions.Cached(
    ProviderName.SQLite, "Data Source=products.db"));

// CRUD operations
var product = repo.Insert(new Product { Name = "Widget", Price = 9.99m });
var all = repo.GetAll();
var expensive = repo.Find(p => p.Price > 100);
repo.Update(product);
repo.Delete(product);
repo.DeleteMany(p => p.Price < 1);
```

### Entity Example
```csharp
[Table("Products")]
public class Product
{
    [PrimaryKey, Identity]
    public int Id { get; set; }

    [Column(Length = 100)]
    public string Name { get; set; }

    [Column(CanBeNull = true)]
    public string Description { get; set; }

    public decimal Price { get; set; }
}
```

### Datastore
Default SQLite with WAL mode. Works with all linq2db providers (SQL Server, PostgreSQL, MySQL, etc) via ProviderName constants.
